<% content_for :head do %>
  <title>Cestlocal.fr</title>
  <script src="https://maps.googleapis.com/maps/api/js?libraries=places&key=AIzaSyB5V1m3yWciaNyGX6XqDc2cVoN9nYujzaI"></script>
<% end %>

<% content_for :pagename do 'index' end %>

<div class="row text-center subtitle">
  <h2><strong>Producteurs</strong> en vente <strong>directe</strong>.</h2>
</div>
<div class="row search-form">
  <form action="/" method="get">
    <div class="medium-6 columns" id="query-input">
      <input type="search" id="q" name="q" placeholder="Légume, fruit, ..." data-autocomplete-url="<%= autocomplete_products_path %>" value="<%= @query %>"/>
    </div>
    <div class="medium-6 columns" id="where-input">
      <input type="search" id="l" name="l" placeholder="Lieu" value="<%= @location_name %>"/>
      <select id="d" name="d">
        <% [[10,'< 10'],[20,'< 20'],[50,'< 50'],[100,'< 100']].each do |v| %>
          <option value="<%= v[0] %>" <%= 'selected="selected"' if @distance == v[0] %>><%= v[1] %> km</option>
        <% end %>
      </select>
    </div>
  </form>
</div>
<div class="row content">
  <div class="small-12 medium-8 columns">
    <% if @farms.empty? %>
      <div class="farms is-empty">
        Aucun producteur trouvé :(
      </div>
    <% else %>
      <div class="farms">
        <ul>
          <% @farms.each do |farm| %>
            <li>
              <%= link_to farm.name, farm_path(farm) %>
              <% unless farm.places.empty? %>
                <div class="places">
                  <i class="fi-marker"></i>
                  <%
                  first = true
                  farm.places.each do |place|
                    concat ' / ' unless first
                    concat link_to place.name, farm_path(farm, place)
                    if @location_coordinates
                      concat " (à #{place.distance_to(@location_coordinates).round}&nbsp;km)".html_safe
                    end
                    first = false
                  end
                  %>
                </div>
              <% end %>
              <% unless farm.products.empty? %>
                <div class="products">
                  <i class="fi-shopping-cart"></i>
                  <% farm.products.first(4).each do |product| %>
                    <span class="label"><%= product.name %></span>
                  <% end %>
                  <% if farm.products.count > 4 %>
                    <span class="label"><%= link_to '...', farm_path(farm) %></span>
                  <% end %>
                </div>
              <% end %>
            </li>
          <% end %>
        </ul>
      </div>
      <%= will_paginate @farms, :param_name => :p %>
    <% end %>
  </div>
</div>

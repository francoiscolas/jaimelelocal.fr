<% content_for :head do %>
  <link rel="stylesheet" href="//cdn.quilljs.com/1.3.6/quill.snow.css" />
  <script>
    var farm = <%=raw @farm.to_json(:only => [:name, :phone, :address, :lat, :lng]) %>;
    <% if @farm.page_content.blank? %>
      farm.page_content = [
        {type: 'text'}, {type: 'map'}, {type: 'contact'}
      ];
    <% else %>
      farm.page_content = <%=raw @farm.page_content %>;
    <% end %>
  </script>
  <% if @is_owner %>
    <script src="//cdn.quilljs.com/1.3.6/quill.min.js"></script>
  <% end %>
<% end %>
<% content_for :title do "#{@farm.name} - " end %>
<% content_for :pagename do "farm#{' is-owner' if @is_owner}" end %>
<% content_for :actions do %>
  <% if @is_owner %>
    <%= form_for @farm, url: user_farm_path, html: { id: 'page-content-form' } do |f| %>
      <%= f.hidden_field :page_content %>
      <button class="action" type="button">
        <i class="fi-save"></i><span class="hide-for-small-only"> Enregistrer les modifications</span>
      </button>
    <% end %>
  <% end %>
<% end %>
<div class="banner">
  <h1><%= @farm.name %></h1>
  <div class="banner-btns" style="background-image:url(<%= asset_path @farm.page_header %>)">
    <% if @is_owner %>
      <%= form_for @farm, url: user_farm_path, multipart: true, 'data-closable': true do |f| %>
        <%= f.label :page_header, "Modifier l'image", class: 'update-banner banner-btn' %>
        <%= f.file_field :page_header, class: 'show-for-sr' %>
        <button type="button" class="remove-banner banner-btn">Supprimer l'image</button>
      <% end %>
      <%= link_to 'Voir la page publique', farm_path(@farm), class: 'go-public banner-btn' %>
    <% else %>
      <% if false && user_signed_in? && current_user.subscribed_to?(@farm) %>
        <!-- Never go there. This feature will be enabled later. -->
        <%= link_to farm_subscribtion_path(@farm), method: :delete, class: 'unfollow banner-btn' do %>
          NE PLUS SUIVRE
        <% end %>
      <% else %>
        <button type="button" class="follow banner-btn" data-toggle="follow-pane">SUIVRE</button>
        <div class="dropdown-pane left" id="follow-pane" data-dropdown data-hover="true" data-hover-pane="true">
          <%= form_for @farm.subscribtions.new, url: farm_subscribtion_path(@farm) do |f| %>
            <div>
              <%= f.label :email %>
              <%= f.text_field :email %>
            </div>
            <div class="actions">
              <%= f.submit "Suivre ce producteur", class: 'button' %>
            </div>
          <% end %>
        </div>
      <% end %>
    <% end %>
  </div>
  <div class="infos">
    <% if @farm.shortdesc.present? %>
      <p><%= @farm.shortdesc %></p>
    <% end %>
    <i class="fi-telephone"></i>
    <a href="tel://<%= @farm.phone %>">
      <%= @farm.phone %></a><br/>
    <i class="fi-mail"></i>
    <a href="mailto://<%= @farm.email %>">
      <%= @farm.email %></a><br/>
    <% if @farm.website.present? %>
      <i class="fi-web"></i>
      <a href="<%= @farm.website %>">
        <%= @farm.website %></a><br/>
    <% end %>
    <i class="fi-marker"></i>
    <div>
      <%=address_to_bloc @farm.address %>
      <br/><u>Lat</u> : <%= @farm.lat %>
      <br/><u>Lon</u> : <%= @farm.lng %>
    </div>
  </div>
</div>
<div id="farm-rows"></div>
